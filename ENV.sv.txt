`ifndef ENV
`define ENV
`include "trans.sv"
`include "interface.sv"
`include "generator.sv"
`include "case1.sv"
`include "case2.sv"
`include "case3.sv"
`include "case4.sv"
`include "driver.sv"
`include "monitor.sv"
`include "scoreboard.sv"

class env;
  driver drv;
  monitor mon;
  scoreboard scb;
  reset_check rc;
  write_oper wo;
  read_oper ro;
  sim_rw sw;
  mailbox gen2drv;
  mailbox mon2scb;
  virtual intf inf;

  int testcase_select; // 0-reset, 1-write, 2-read, 3-sim_rw

  function new(virtual intf inf);
    this.inf = inf;
    mon2scb = new();
    gen2drv = new();

    rc = new(gen2drv);
    wo = new(gen2drv);
    ro = new(gen2drv);
    sw = new(gen2drv);
    drv = new(gen2drv, inf);
    mon = new(inf, mon2scb);
    scb = new(mon2scb);
  endfunction

  task run();
    fork
      drv.run(); //forever
      mon.run(); //forever
      scb.run(); //forever
    join_none

    // Choose which generator to run
    case (testcase_select)
      0: rc.run();
      1: wo.run();
      2: ro.run();
      3: sw.run();
      default: $display("[ENV] Invalid testcase_select value");
    endcase
  endtask
endclass
`endif
